function insertIntoCanvas(canvas, layoutId, targetId, item, columnIndex = null) {
  return canvas.map(layout => {
    if (layout.layoutId !== layoutId) return layout;

    // Case 1: inserting at layout level â†’ push row
    if (!targetId) {
      return {
        ...layout,
        rows: [...layout.rows, item]
      };
    }

    // Case 2: inserting inside a row's columns
    const updatedRows = layout.rows.map(row => {
      if (row.rowId === targetId && item.type !== "row") {
        // inserting a column into this row
        const newColumns = [...row.columns];
        if (columnIndex !== null) {
          newColumns.splice(columnIndex, 0, item);
        } else {
          newColumns.push(item);
        }
        return { ...row, columns: newColumns };
      }

      // Case 3: search inside columns for nested rows
      const updatedColumns = row.columns.map(col => {
        if (col.id === targetId && item.type === "row") {
          return {
            ...col,
            rows: [...(col.rows || []), item]
          };
        }
        return col;
      });

      return { ...row, columns: updatedColumns };
    });

    return { ...layout, rows: updatedRows };
  });
}